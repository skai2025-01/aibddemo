<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subic EBPS: Electronic Bills Payment System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and base colors */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #334155; /* Dark slate gray text */
        }

        /* Modernized Button Styles */
        /* General button styles - will be overridden by specific classes where needed */
        .btn-primary {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            padding: 0.75rem 1.75rem; /* More comfortable padding */
            border-radius: 1rem; /* More rounded */
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.2); /* Deeper blue shadow */
            border: none;
            font-size: 1rem; /* Standard button text size */
        }
        .btn-primary:hover {
            background-color: #2563eb; /* Blue-600 */
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3); /* Enhanced shadow */
        }
        .btn-secondary {
            background-color: #e2e8f0; /* Blue-gray-200 */
            color: #475569; /* Slate-600 */
            padding: 0.75rem 1.75rem;
            border-radius: 1rem; /* More rounded */
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            border: 1px solid #cbd5e1; /* Clearer border */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08); /* Softer shadow */
            font-size: 1rem;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1; /* Blue-gray-300 */
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
        }

        /* Specific button sizes for .bill-card action buttons */
        .bill-card .btn-action-small {
            padding: 0.6rem 1.2rem; /* Reduced padding */
            font-size: 0.9rem; /* Reduced font size */
            border-radius: 0.8rem; /* Slightly less rounded than 1rem */
        }
        .bill-card .btn-primary.btn-action-small {
            background-color: #3b82f6;
            color: white;
        }
        .bill-card .btn-primary.btn-action-small:hover {
            background-color: #2563eb;
            transform: translateY(-2px); /* Slightly less lift */
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.25);
        }
        .bill-card .btn-secondary.btn-action-small {
            background-color: #e2e8f0;
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        .bill-card .btn-secondary.btn-action-small:hover {
            background-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Card styling for modern look */
        .bill-card {
            background-color: white;
            border-radius: 1.5rem; /* Even more rounded */
            padding: 2rem; /* More generous padding */
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08), 0 5px 15px -2px rgba(0, 0, 0, 0.05); /* Lighter, broader shadow */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            border: 1px solid #f8fafc; /* Almost invisible border */
            transition: transform 0.2s ease-in-out;
        }
        .bill-card:hover {
            transform: translateY(-5px); /* Subtle lift on hover */
        }

        .nav-link {
            padding: 0.6rem 1.2rem;
            border-radius: 0.75rem; /* Rounded */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            font-weight: 500;
            font-size: 0.95rem;
            color: #3b82f6; /* Primary blue for nav links */
        }
        .nav-link:hover {
            background-color: #dbeafe; /* Blue-100 */
            color: #2563eb; /* Darker blue on hover */
        }

        /* Table specific styles for a clean look */
        .bill-table {
            width: 100%;
            border-collapse: separate; /* Use separate to apply border-radius to cells */
            border-spacing: 0; /* Remove default spacing */
            margin-top: 2rem;
            border-radius: 0.75rem; /* Rounded table */
            overflow: hidden; /* Hide overflow for rounded corners */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Subtle table shadow */
        }
        .bill-table th, .bill-table td {
            padding: 1.2rem 1.5rem; /* More padding in table cells */
            text-align: left;
            border-bottom: 1px solid #e0e7ed; /* Lighter borders */
            font-size: 0.95rem; /* Larger table text */
        }
        .bill-table th {
            background-color: #eef2f6; /* Light blue-gray background for header */
            font-weight: 600;
            color: #475569;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em; /* Slightly spaced out text */
        }
        .bill-table tbody tr:last-child td {
            border-bottom: none;
        }
        .bill-table tbody tr:hover {
            background-color: #f6f8fb; /* Subtle hover effect */
        }
        .btn-view-receipt {
            background-color: #10b981; /* Green-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.6rem;
            font-weight: 500;
            font-size: 0.85rem;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.2);
        }
        .btn-view-receipt:hover {
            background-color: #059669; /* Green-600 */
            transform: translateY(-1px);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2.5rem; /* More padding */
            border-radius: 1.5rem; /* More rounded */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* Deeper shadow */
            width: 90%;
            max-width: 550px; /* Slightly wider modal */
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem; /* Larger close button */
            cursor: pointer;
            color: #64748b; /* Slate-500 */
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #ef4444; /* Red on hover */
        }
        .modal-content h3 {
            font-size: 1.5rem; /* Larger modal title */
            color: #1e293b; /* Darker title */
        }
        .modal-content p {
            font-size: 1rem; /* Standard text size */
            line-height: 1.6; /* Better readability */
        }

        /* Payment page specific styles */
        .payment-summary-card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        .payment-line-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed #e2e8f0;
            font-size: 1.1rem;
            color: #475569;
        }
        .payment-line-item:last-of-type {
            border-bottom: none;
        }
        .payment-total {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            padding-top: 1.5rem;
        }

        /* Account Management Section Styles (moved to separate page, but styles kept for consistency if needed) */
        .account-section-card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-top: 2rem;
            text-align: center;
        }
        .account-feature-item {
            background-color: #eef2f6;
            border: 1px solid #dbeafe;
            border-radius: 0.75rem;
            padding: 1.5rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: #3b82f6;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .account-feature-item:hover {
            background-color: #dbeafe;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        /* Hero Section Background */
        .hero-section-wrapper {
            background: linear-gradient(to right, #bfdbfe, #93c5fd); /* Blue gradient */
            padding: 2rem 0; /* Vertical padding, no horizontal padding here */
            border-radius: 0; /* Make it straight to the edges */
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1); /* Subtle blue shadow */
            margin-bottom: 3rem; /* Space below the hero section */
            /* Removed width: 100vw; and negative margins as it's now outside the main container */
        }
        .hero-section-wrapper .bg-white {
            background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent white for content card */
            box-shadow: none; /* Remove inner shadow */
            border: none; /* Remove inner border */
            max-width: 7xl; /* Constrain content width */
            margin-left: auto; /* Center content within wrapper */
            margin-right: auto;
            padding: 2rem; /* Add back content padding */
        }

        /* Header as Menubar */
        header {
            background: linear-gradient(to right, #bfdbfe, #93c5fd); /* Use the same gradient as hero for consistency */
            padding: 0; /* Remove padding from header itself as inner div will handle it */
            border-radius: 0 !important; /* Override rounded-3xl from Tailwind */
            box-shadow: none !important; /* Remove shadow */
            margin-bottom: 0 !important; /* Remove bottom margin */
            /* Removed width: 100vw; and negative margins as it's now outside the main container */
            z-index: 20; /* Ensure it's above other content */
            border-bottom: 1px solid #dbeafe; /* Subtle bottom border */
        }
        /* Header inner content for alignment and padding */
        .header-inner-content {
            padding: 1.5rem 1.5rem; /* Default padding for mobile */
            max-width: 7xl; /* Apply max-width here */
            margin-left: auto; /* Center the content */
            margin-right: auto;
            display: flex;
            flex-direction: column; /* Stack on mobile */
            align-items: center;
            text-align: center;
            width: 100%; /* Ensure it takes full width of its parent */
        }

        @media (min-width: 640px) { /* sm breakpoint */
            .header-inner-content {
                flex-direction: row; /* Row on sm+ */
                justify-content: space-between; /* Space out elements */
                text-align: left;
                padding: 1.5rem 2.5rem; /* More padding for larger screens */
            }
        }
        /* Hide subtitle in menubar for cleaner look */
        header p {
            display: none;
        }
        header h1 {
            margin-bottom: 0 !important; /* Remove margin from h1 */
        }
        header nav {
            margin-top: 0 !important;
            margin-left: auto; /* Push nav to the right */
        }
        header .nav-link {
            color: #2563eb; /* Darker blue for nav links in menubar */
            font-weight: 600;
        }
        header .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Subtle hover */
            color: #1e40af;
        }

        /* Page content container to manage visibility */
        .page-content {
            display: none; /* Hidden by default */
        }
        .page-content.active {
            display: block; /* Show active page */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-between">
    <!-- Header Section - Common for all pages -->
    <header class="bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 text-center
                   flex flex-col sm:flex-row sm:justify-between sm:items-center sm:text-left">
        <div class="header-inner-content">
            <div class="text-center sm:text-left mb-4 sm:mb-0">
                <h1 class="text-4xl font-extrabold mb-2 leading-tight">Subic EBPS</h1>
                <p class="text-xl font-light" id="header-subtitle">Electronic Bills Payment System</p>
            </div>
            <!-- Navigation Links and Login/Logout -->
            <nav class="flex flex-wrap justify-center sm:justify-end gap-3 items-center">
                <a href="javascript:void(0)" data-target="home-page" class="nav-link">Home</a>
                <a href="javascript:void(0)" data-target="summary-page" class="nav-link">Summary of Bills</a>
                <a href="javascript:void(0)" data-target="account-management-page" class="nav-link" id="account-management-nav-link">Account Management</a>
                <span id="auth-status" class="ml-4 text-lg font-semibold text-blue-700"></span>
                <button id="auth-button" class="btn-primary ml-4 px-6 py-2 text-base" onclick="toggleAuth()">Login</button>
            </nav>
        </div>
    </header>

    <!-- Introduction Section - Now wrapped in a hero-section-wrapper, outside the main container -->
    <div class="hero-section-wrapper">
        <section class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100">
            <h2 class="text-3xl font-semibold text-center mb-6 text-gray-700">Welcome to Your Official Payment Portal!</h2>
            <p class="text-lg text-center text-gray-600 leading-relaxed max-w-4xl mx-auto">
                Manage and settle your government service fees, taxes, and business payments for Subic Bay Metropolitan Authority with unparalleled ease and transparency.
            </p>
        </section>
    </div>

    <!-- Main Content Container -->
    <div class="container mx-auto p-6 md:p-10 flex-grow max-w-7xl">

        <!-- Home Page Content -->
        <div id="home-page" class="page-content">
            <!-- Outstanding Bills Section - Now with ID for JS control -->
            <section id="outstanding-bills-section" class="mb-12">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Your Outstanding Bills at a Glance</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- Bill Card 1: Real Property Tax -->
                    <div class="bill-card">
                        <div>
                            <h3 class="text-2xl font-bold text-blue-700 mb-3">Real Property Tax</h3>
                            <p class="text-base text-gray-600 mb-1.5"><span class="font-semibold">Billing Period:</span> CY 2025</p>
                            <p class="text-base text-gray-600 mb-1.5"><span class="font-semibold">Property Address:</span> Lot 123, Block 45, Subic Townhomes</p>
                            <p class="text-base text-gray-600 mb-4"><span class="font-semibold">Account No.:</span> RPT-123456789</p>
                            <p class="text-base font-extrabold text-red-600 mb-6">PHP 15,500.<small class="text-sm">00</small></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 mb-6 font-medium">Due Date: July 31, 2025</p>
                            <div class="flex flex-col sm:flex-row gap-4 mt-auto">
                                <button class="btn-primary btn-action-small w-full sm:w-auto">Pay Online</button>
                                <a href="javascript:void(0)" class="btn-secondary btn-action-small text-center w-full sm:w-auto flex items-center justify-center">Offline Options</a>
                            </div>
                        </div>
                    </div>

                    <!-- Bill Card 2: Business Permit Renewal Fee -->
                    <div class="bill-card">
                        <div>
                            <h3 class="text-2xl font-bold text-green-700 mb-3">Business Permit Renewal Fee</h3>
                            <p class="text-base text-gray-600 mb-1.5"><span class="font-semibold">Business Name:</span> Subic Tech Solutions Inc.</p>
                            <p class="text-base text-gray-600 mb-1.5"><span class="font-semibold">Permit No.:</span> BP-987654321</p>
                            <p class="text-base text-gray-600 mb-4"><span class="font-semibold">Type:</span> IT Services</p>
                            <p class="text-base font-extrabold text-red-600 mb-6">PHP 8,250.<small class="text-sm">00</small></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 mb-6 font-medium">Due Date: August 15, 2025</p>
                            <div class="flex flex-col sm:flex-row gap-4 mt-auto">
                                <button class="btn-primary btn-action-small w-full sm:w-auto">Pay Online</button>
                                <a href="javascript:void(0)" class="btn-secondary btn-action-small text-center w-full sm:w-auto flex items-center justify-center">Offline Options</a>
                            </div>
                        </div>
                    </div>

                    <!-- Placeholder for no other bills -->
                    <div class="bill-card bg-gray-50 border-dashed border-2 border-gray-200 flex items-center justify-center p-8 text-gray-500 text-center col-span-1 md:col-span-2">
                        <p class="text-xl font-semibold">No other outstanding bills at this time. Thank you!</p>
                    </div>

                </div>
            </section>

            <!-- Consolidated Payment Options Section -->
            <section id="payment-options" class="mb-12 p-8 bg-white rounded-2xl shadow-lg border border-gray-100">
                <h2 class="text-3xl font-bold text-center mb-7 text-gray-800">Convenient Payment Options</h2>
                <p class="text-lg text-center text-gray-600 mb-7 max-w-4xl mx-auto">
                    All payments will be securely deposited to a designated **DBP Deposit Account**. Choose the method most convenient for you:
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Internet Payment Gateway -->
                    <div class="p-6 bg-blue-50 border border-blue-200 rounded-xl shadow-sm text-center">
                        <h3 class="text-xl font-semibold text-blue-800 mb-3">Internet Payment Gateway</h3>
                        <p class="text-sm text-gray-600 mb-4">Pay securely online using:</p>
                        <ul class="list-disc list-inside text-gray-700 text-base text-left mx-auto max-w-[200px] space-y-1">
                            <li>DBP Direct Debit</li>
                            <li>Leading e-Wallets (GCash, PayMaya, etc.)</li>
                            <li>Major Credit / Debit Cards (Visa, Mastercard)</li>
                        </ul>
                        <p class="text-xs text-gray-500 mt-4">*Powered by DBP's secure portal.</p>
                    </div>

                    <!-- Pay via QR Code -->
                    <div class="p-6 bg-green-50 border border-green-200 rounded-xl shadow-sm text-center">
                        <h3 class="text-xl font-semibold text-green-800 mb-3">Pay via QR Code</h3>
                        <p class="text-sm text-gray-600 mb-4">Generate a DBP-generated QR code for your bill and pay using your mobile banking app or e-wallet app that supports QR Ph.</p>
                        <p class="text-xs text-gray-500 mt-4">*Funds directly deposited to SBMA's DBP account.</p>
                    </div>

                    <!-- Kiosk Style with Card Terminal -->
                    <div class="p-6 bg-purple-50 border border-purple-200 rounded-xl shadow-sm text-center col-span-1 md:col-span-2">
                        <h3 class="text-xl font-semibold text-purple-800 mb-3">Kiosk/Card Terminal (On-site Payment)</h3>
                        <p class="text-sm text-gray-600 mb-4">For convenient on-site payments, visit our designated payment kiosks. You can pay using your debit or credit card directly at the terminal.</p>
                        <p class="text-xs text-gray-500 mt-4">*Available at SBMA Treasury Office and other designated payment centers. Funds directly deposited to SBMA's DBP account.</p>
                    </div>

                    <!-- Traditional DBP Bank Deposit -->
                    <div class="p-6 bg-yellow-50 border border-yellow-200 rounded-xl shadow-sm text-center col-span-1 md:col-span-2">
                        <h3 class="text-xl font-semibold text-yellow-800 mb-3">Traditional Bank Deposit</h3>
                        <p class="text-sm text-gray-600 mb-4">Settle your payments through:</p>
                        <ul class="list-disc list-inside text-gray-700 text-base text-left mx-auto max-w-sm space-y-1">
                            <li>Over-the-Counter Deposits at any DBP branch nationwide.</li>
                            <li>Direct Bank Transfer to SBMA's official DBP account.</li>
                        </ul>
                        <p class="text-xs text-gray-500 mt-4">*Always retain your official payment receipt.</p>
                    </div>
                </div>
                <p class="text-center text-sm text-gray-500 mt-8">
                    *Note: This is a conceptual demonstration. All actual payment processing is secured with bank-grade encryption and will settle to a DBP Deposit Account.
                </p>
            </section>
        </div>

        <!-- Summary of Bills Page Content -->
        <div id="summary-page" class="page-content hidden">
            <!-- Summary Introduction Section -->
            <section class="bg-white p-8 rounded-2xl shadow-lg mb-12 border border-gray-100">
                <h2 class="text-3xl font-semibold text-center mb-6 text-gray-700">All Your Bills in One Place</h2>
                <p class="text-lg text-center text-gray-600 leading-relaxed max-w-4xl mx-auto">
                    Review your outstanding and recently paid government bills. Select bills to pay or view details.
                </p>
            </section>

            <!-- Bills Table Section -->
            <section class="mb-12 p-8 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-x-auto">
                <table class="bill-table">
                    <thead>
                        <tr>
                            <th>Service/Bill Type</th>
                            <th>Account No.</th>
                            <th>Billing Period</th>
                            <th>Due Date</th>
                            <th>Amount Due</th>
                            <th>Status</th>
                            <th>Action</th>
                            <th>e-Receipt</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Bill 1: Real Property Tax -->
                        <tr>
                            <td class="text-base font-medium text-blue-700">Real Property Tax</td>
                            <td class="text-sm text-gray-700">RPT-123456789</td>
                            <td class="text-sm text-gray-700">CY 2025</td>
                            <td class="text-sm text-red-600 font-semibold">July 31, 2025</td>
                            <td class="text-base font-bold text-red-600">PHP 15,500.00</td>
                            <td><span class="px-3 py-1 text-sm font-semibold text-red-700 bg-red-100 rounded-full">Unpaid</span></td>
                            <td>
                                <button class="btn-primary" onclick="showPaymentPage('Real Property Tax', 15500.00)">Pay</button>
                            </td>
                            <td></td>
                        </tr>
                        <!-- Bill 2: Business Permit Renewal Fee -->
                        <tr>
                            <td class="text-base font-medium text-green-700">Business Permit Renewal Fee</td>
                            <td class="text-sm text-gray-700">BP-987654321</td>
                            <td class="text-sm text-gray-700">2025</td>
                            <td class="text-sm text-red-600 font-semibold">August 15, 2025</td>
                            <td class="text-base font-bold text-red-600">PHP 8,250.00</td>
                            <td><span class="px-3 py-1 text-sm font-semibold text-red-700 bg-red-100 rounded-full">Unpaid</span></td>
                            <td>
                                <button class="btn-primary" onclick="showPaymentPage('Business Permit Renewal Fee', 8250.00)">Pay</button>
                            </td>
                            <td></td>
                        </tr>
                        <!-- Bill 3: Community Tax Certificate -->
                        <tr>
                            <td class="text-base font-medium text-purple-700">Community Tax Cert.</td>
                            <td class="text-sm text-gray-700">CTC-555444</td>
                            <td class="text-sm text-gray-700">CY 2025</td>
                            <td class="text-sm text-gray-800 font-semibold">September 30, 2025</td>
                            <td class="text-base font-bold text-gray-800">PHP 200.00</td>
                            <td><span class="px-3 py-1 text-sm font-semibold text-red-700 bg-red-100 rounded-full">Unpaid</span></td>
                            <td>
                                <button class="btn-primary" onclick="showPaymentPage('Community Tax Certificate', 200.00)">Pay</button>
                            </td>
                            <td></td>
                        </tr>
                        <!-- Bill 4: Environmental Fee (Paid Example) -->
                        <tr>
                            <td class="text-base font-medium text-gray-700">Environmental Fee</td>
                            <td class="text-sm text-gray-700">ENV-112233</td>
                            <td class="text-sm text-gray-700">Q1 2025</td>
                            <td class="text-sm text-gray-500 font-semibold">March 31, 2025</td>
                            <td class="text-base font-bold text-gray-800">PHP 500.00</td>
                            <td><span class="px-3 py-1 text-sm font-semibold text-green-700 bg-green-100 rounded-full">Paid</span></td>
                            <td>
                                <button class="btn-secondary" disabled>Paid</button>
                            </td>
                            <td><button class="btn-view-receipt">View</button></td>
                        </tr>
                    </tbody>
                </table>

                <div class="mt-10 text-right">
                    <p class="text-2xl font-bold text-gray-800">Total Outstanding Amount: <span class="text-red-700">PHP 23,950.00</span></p>
                    <!-- "Pay All Outstanding" will navigate to payment page with total amount -->
                    <button class="btn-primary text-xl mt-6" onclick="showPaymentPage('All Outstanding Bills', 23950.00)">Proceed to Pay All Outstanding</button>
                    <p class="text-sm text-gray-500 mt-3">Clicking "Pay All" will initiate a combined payment for all unpaid bills.</p>
                </div>
            </section>
        </div>

        <!-- Payment Page Content -->
        <div id="payment-page" class="page-content hidden">
            <section class="bg-white p-8 rounded-2xl shadow-lg mb-12 border border-gray-100 payment-summary-card">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Confirm Your Payment</h2>
                
                <div class="mb-6">
                    <div class="payment-line-item">
                        <span class="font-semibold">Bill Type:</span>
                        <span id="payment-bill-type"></span>
                    </div>
                    <div class="payment-line-item">
                        <span class="font-semibold">Amount Due:</span>
                        <span id="payment-amount-due"></span>
                    </div>
                    <div class="payment-line-item">
                        <span class="font-semibold">Processing Fee:</span>
                        <span id="payment-processing-fee">PHP 25.00</span>
                    </div>
                    <div class="payment-total">
                        Total Payable: <span id="payment-total-payable"></span>
                    </div>
                </div>

                <div class="text-left mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Payment Option</h3>
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-5 text-center shadow-sm">
                        <p class="font-semibold text-blue-800 text-lg">Direct Payment to DBP Deposit Account</p>
                        <p class="text-sm text-gray-600 mt-2">You will be securely redirected to the DBP Payment Portal to complete the transaction.</p>
                    </div>
                </div>

                <button class="btn-primary w-full" onclick="proceedToDbpPortal()">Proceed to DBP Payment Portal</button>
                <button class="btn-secondary w-full mt-4" onclick="showPage('summary-page')">Cancel and Go Back</button>
            </section>
        </div>

        <!-- Account Management Page Content (now loaded dynamically from separate file) -->
        <div id="account-management-page" class="page-content hidden">
            <!-- This content will be dynamically loaded/managed by the main app's JS -->
            <!-- For demonstration, we'll load an iframe here -->
            <iframe id="account-management-iframe" src="ebps-account-management-page.html" class="w-full h-[80vh] border-none rounded-xl shadow-lg" style="min-height: 600px; display: block;"></iframe>
        </div>

    </div>

    <!-- Footer Section - Common for all pages -->
    <footer class="bg-gray-900 text-gray-300 p-6 text-center rounded-t-2xl mt-12">
        <p class="text-sm">&copy; 2025 Subic Bay Metropolitan Authority. All rights reserved.</p>
    </footer>

    <!-- Bill Explanation Modal (kept but hidden, no JS interaction) -->
    <div id="bill-explanation-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeBillExplanationModal()">Ã—</button>
            <h3 class="text-xl font-bold text-gray-800 mb-4" id="modal-bill-title"></h3>
            <p class="text-gray-700 mb-4" id="modal-bill-explanation"></p>
            <div id="modal-loading-indicator" class="hidden text-center">
                <p class="text-blue-500">Generating explanation...</p>
            </div>
            <button class="btn-primary mt-4 mx-auto block" onclick="closeBillExplanationModal()">Close</button>
        </div>
    </div>

    <script>
        const PROCESSING_FEE = 25.00; // Define processing fee
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true'; // Simulate login state

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded for ebps-combined-app');

            const homePage = document.getElementById('home-page');
            const summaryPage = document.getElementById('summary-page');
            const paymentPage = document.getElementById('payment-page');
            const accountManagementPage = document.getElementById('account-management-page');
            const accountManagementIframe = document.getElementById('account-management-iframe');
            const outstandingBillsSection = document.getElementById('outstanding-bills-section');

            const headerSubtitle = document.getElementById('header-subtitle');
            const navLinks = document.querySelectorAll('.nav-link');
            const authStatus = document.getElementById('auth-status');
            const authButton = document.getElementById('auth-button');
            const accountManagementNavLink = document.getElementById('account-management-nav-link');

            const paymentBillType = document.getElementById('payment-bill-type');
            const paymentAmountDue = document.getElementById('payment-amount-due');
            const paymentTotalPayable = document.getElementById('payment-total-payable');

            const billExplanationModal = document.getElementById('bill-explanation-modal');
            const modalBillExplanation = document.getElementById('modal-bill-explanation');
            const modalLoadingIndicator = document.getElementById('modal-loading-indicator');

            // Function to update header based on login status
            function renderHeaderNav() {
                console.log('renderHeaderNav called. isLoggedIn:', isLoggedIn);
                if (isLoggedIn) {
                    authStatus.textContent = 'Welcome, User!';
                    authButton.textContent = 'Logout';
                    authButton.classList.remove('btn-primary');
                    authButton.classList.add('btn-secondary');
                    accountManagementNavLink.classList.remove('hidden'); // Show Account Management link
                    outstandingBillsSection.classList.remove('hidden'); // Show Outstanding Bills
                } else {
                    authStatus.textContent = '';
                    authButton.textContent = 'Login';
                    authButton.classList.remove('btn-secondary');
                    authButton.classList.add('btn-primary');
                    accountManagementNavLink.classList.add('hidden'); // Hide Account Management link
                    outstandingBillsSection.classList.add('hidden'); // Hide Outstanding Bills
                }
            }

            // Function to toggle login state
            window.toggleAuth = () => {
                isLoggedIn = !isLoggedIn;
                localStorage.setItem('isLoggedIn', isLoggedIn);
                console.log('toggleAuth called. New isLoggedIn state:', isLoggedIn);
                renderHeaderNav();
                // If logging out from summary or payment or account management page, redirect to home
                if (!isLoggedIn && (summaryPage.classList.contains('active') || paymentPage.classList.contains('active') || accountManagementPage.classList.contains('active'))) {
                    console.log('Logged out from a restricted page, redirecting to home.');
                    showPage('home-page');
                }
            };

            // Function to show a specific page and update header subtitle
            window.showPage = (pageId, billType = null, amount = null) => {
                console.log(`showPage called for: ${pageId}, isLoggedIn: ${isLoggedIn}`);

                // Hide all pages first by removing the 'active' class
                document.querySelectorAll('.page-content').forEach(page => {
                    if (page.classList.contains('active')) {
                        page.classList.remove('active');
                        console.log(`Deactivated page: ${page.id}`);
                    }
                });

                let currentPageElement = null;
                let newSubtitle = '';

                if (pageId === 'home-page') {
                    currentPageElement = homePage;
                    newSubtitle = 'Electronic Bills Payment System';
                } else if (pageId === 'summary-page') {
                    if (!isLoggedIn) {
                        alert('Please log in to view your summary of bills.');
                        showPage('home-page');
                        return;
                    }
                    currentPageElement = summaryPage;
                    newSubtitle = 'Summary of Your Bills';
                } else if (pageId === 'payment-page') {
                    if (!isLoggedIn) {
                        alert('Please log in to proceed with payment.');
                        showPage('home-page');
                        return;
                    }
                    currentPageElement = paymentPage;
                    newSubtitle = 'Confirm Payment';
                    updatePaymentDetails(billType, amount);
                } else if (pageId === 'account-management-page') {
                    if (!isLoggedIn) {
                        alert('Please log in to access Account Management.');
                        showPage('home-page');
                        return;
                    }
                    currentPageElement = accountManagementPage;
                    newSubtitle = 'Account Management';
                    // Explicitly set iframe src to ensure it loads/reloads
                    accountManagementIframe.src = 'ebps-account-management-page.html';
                    console.log('Account Management iframe src set to:', accountManagementIframe.src);
                }

                if (currentPageElement) {
                    console.log(`Attempting to activate page element: ${currentPageElement.id}. Current classes: ${Array.from(currentPageElement.classList).join(', ')}`);
                    currentPageElement.classList.add('active'); // Show the target page by adding 'active'
                    console.log(`After adding active. New classes: ${Array.from(currentPageElement.classList).join(', ')}`);
                    headerSubtitle.textContent = newSubtitle;
                    console.log(`Page '${pageId}' activated.`);
                } else {
                    console.error(`Could not find page element for ID: ${pageId}`);
                }
            };

            // Function to update details on the payment page
            function updatePaymentDetails(billType, amount) {
                if (billType && amount !== null) {
                    const totalPayable = amount + PROCESSING_FEE;
                    paymentBillType.textContent = billType;
                    paymentAmountDue.textContent = `PHP ${amount.toFixed(2)}`;
                    paymentTotalPayable.textContent = `PHP ${totalPayable.toFixed(2)}`;
                } else {
                    paymentBillType.textContent = 'N/A';
                    paymentAmountDue.textContent = 'PHP 0.00';
                    paymentTotalPayable.textContent = `PHP ${PROCESSING_FEE.toFixed(2)}`;
                }
            }

            // Function to handle "Proceed to DBP Payment Portal" click
            window.proceedToDbpPortal = () => {
                alert('Redirecting to DBP Payment Portal for secure transaction...');
                showPage('summary-page');
            };

            // Event listeners for top navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetPageId = link.dataset.target;
                    showPage(targetPageId);
                });
            });

            // Function for "Pay" buttons in summary table to show payment page
            window.showPaymentPage = (billType, amount) => {
                showPage('payment-page', billType, amount);
            };

            // Listen for messages from the iframe (e.g., "Back to Home" button)
            window.addEventListener('message', (event) => {
                // In a real application, you would verify event.origin for security
                // For this demo, we'll trust all messages for simplicity
                if (event.data && event.data.page) {
                    console.log('Message received from iframe to show page:', event.data.page);
                    showPage(event.data.page);
                }
            });

            // Initial rendering based on stored login state
            renderHeaderNav();

            // Handle initial load to ensure correct page is shown
            const initialHash = window.location.hash.replace('#', '');
            if (initialHash && document.getElementById(initialHash)) {
                console.log('Initial hash found:', initialHash);
                showPage(initialHash);
            } else {
                console.log('No initial hash, showing home page.');
                showPage('home-page');
            }

            // Modal functions (kept but not actively used for AI explanation)
            window.openBillExplanationModal = () => {
                billExplanationModal.classList.remove('hidden');
            };

            window.closeBillExplanationModal = () => {
                billExplanationModal.classList.add('hidden');
                modalBillExplanation.textContent = '';
                modalLoadingIndicator.classList.add('hidden');
            };
        });
    </script>
</body>
</html>

